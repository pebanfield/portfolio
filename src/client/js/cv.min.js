cv={};cv.utils={};cv.model={};cv.view={};cv.commands={};cv.utils.CodeStyleMap=new Class({styleMap:[],resourceMap:[],initialize:function(){this.styleMap.scpt={name:"applescript",resource:"shBrushAppleScript.js"};this.styleMap.as={name:"actionscript3",resource:"shBrushAS3.js"};this.styleMap.sh={name:"bash",resource:"shBrushBash.js"};this.styleMap.cfm={name:"coldfusion",resource:"shBrushColdFusion.js"};this.styleMap.cpp={name:"cpp",resource:"shBrushCpp.js"};this.styleMap.cs={name:"c#",resource:"shBrushCSharp.js"};this.styleMap.css={name:"css",resource:"shBrushCss.js"};this.styleMap.pas={name:"delphi",resource:"shBrushDelphi.js"};this.styleMap.diff={name:"diff",resource:"shBrushDiff.js"};this.styleMap.erl={name:"erl",resource:"shBrushErlang.js"};this.styleMap.groovy={name:"groovy",resource:"shBrushGroovy.js"};this.styleMap.java={name:"java",resource:"shBrushJava.js"};this.styleMap.jfx={name:"jfx",resource:"shBrushJavaFX.js"};this.styleMap.js={name:"js",resource:"shBrushJScript.js"};this.styleMap.perl={name:"pl",resource:"shBrushPerl.js"};this.styleMap.php={name:"php",resource:"shBrushPhp.js"};this.styleMap.txt={name:"text",resource:"shBrushPlain.js"};this.styleMap.py={name:"py",resource:"shBrushPython.js"};this.styleMap.rb={name:"ruby",resource:"shBrushRuby.js"};this.styleMap.scl={name:"scala",resource:"shBrushScala.js"};this.styleMap.sql={name:"sql",resource:"shBrushSql.js"};this.styleMap.vb={name:"vb",resource:"shBrushVb.js"};this.styleMap.xml={name:"xml",resource:"shBrushXml.js"}},getStyleByExtension:function(b){try{return this.styleMap[b].name}catch(a){return"text"}},getResourceByExtension:function(b){try{return this.styleMap[b].resource}catch(a){return"shBrushPlain.js"}}});cv.utils.DateParser=new Class({});cv.utils.DateParser.parse=function(b){var f=b.split("T");var e=f[0];var c=e.split("-");var d=c[0];var h=c[1];var a=c[2];var g=f[1].split("-")[0];return{ymd:e,year:d,month:h,day:a,time:g}};cv.utils.DateParser.getGregorianDay=function(b){var a=cv.utils.DateParser.parse(b);var c=new Date();c.setFullYear(Number(a.year));c.setMonth(Number(a.month-1));c.setDate(Number(a.day));var d=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"];return d[c.getDay()]};cv.utils.DateParser.getGregorianMonth=function(b){var a=cv.utils.DateParser.parse(b);var d=new Date();d.setFullYear(Number(a.year));d.setMonth(Number(a.month-1));d.setDate(Number(a.day));var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=Number(d.getMonth());return e[c]};cv.utils.DateParser.dateIsDifferent=function(b,a){try{var f=cv.utils.DateParser.parse(b);var c=cv.utils.DateParser.parse(a)}catch(d){return true}if(f.year!=c.year){return true}else{if(f.month!=c.month){return true}else{if(f.day!=c.day){return true}else{return false}}}};cv.utils.Logger=new Class({});cv.utils.Logger.log=function(a){if(window.console){console.log(a)}};cv.utils.Translate=new Class({});cv.utils.Translate.localToGlobal=function(a,d){var c=Window.getSize().x/2;var b=Window.getSize().y/2;a+=c;d+=b;return{x:a,y:d}};cv.model.ConfigProxy=new Class({Extends:Proxy,serviceDomain:"localhost:9089",revisionsMethod:"/lichen/repodata/revisions",pageNum:null,pageSize:7,viewportWidth:1000,lineColor:"#000",requestObj:null,requestor:null,initialize:function(){this.parent(cv.model.ConfigProxy.NAME)}});cv.model.ConfigProxy.NAME="ConfigProxy";cv.model.Entry=new Class({revision:null,path:null,name:null,size:null,significance:null,status:null,author:null,type:null,kind:null,uuid:null,patch:null,raw_url:null,commit_date:null,commit_time:null,commit_revision:null,sizeHistory:null,authorHistory:null,pathHistory:null,updateTimeHistory:null,revisionHistory:null,uuidHistory:null});cv.model.RepoDataProxy=new Class({Extends:Proxy,Implements:Events,LARGE_PAGE_LENGTH:10,SMALL_PAGE_LENGTH:7,cvsType:null,activeRevisionIndex:-1,visualPageTotal:0,truePageTotal:0,currentPage:null,currentPageNum:1,currentPageSize:10,activePageIndex:-1,_cursorIndex:0,repoLocation:"file:///Users/pebanfield/SVNrep/ChangeView",currentRepoPath:null,codeStyleMap:null,viewportWidth:0,_revisions:[],_glyphs:[],_authors:[],_activeRevision:null,_repoRootPath:null,_colors:null,_colorIndex:-1,_currentAuthor:"",_containsLatest:false,_containsFirst:false,initialize:function(){this.parent(cv.model.RepoDataProxy.NAME);this.codeStyleMap=new cv.utils.CodeStyleMap()},getActiveRevision:function(){return this._activeRevision},setActiveRevision:function(a){this.activeRevisionIndex=a;this._activeRevision=this.currentPage[this.activeRevisionIndex];this.fireEvent(cv.model.EventTypes.ACTIVE_REV_CHANGE,this._activeRevision)},setRepoRootPath:function(a){this._repoRootPath=a;this.fireEvent(cv.model.EventTypes.REPO_TITLE_CHANGE,this._repoRootPath)},setColors:function(a){this._colors=a},getRepoPath:function(){return this._repoRootPath},addPage:function(b,c,a){cv.utils.Logger.log("ADD PAGE");cv.utils.Logger.log("revisions.length = "+b.length);cv.utils.Logger.log("isLatest = "+c);cv.utils.Logger.log("isFirst = "+a);b=this._addRevisionGlyphs(b);this._revisions=this._revisions.concat(b);this.visualPageTotal=this._revisions.length/this.LARGE_PAGE_LENGTH;this.truePageTotal=this._revisions.length/this.LARGE_PAGE_LENGTH;if(this._revisions.length<this.currentPageSize){this._cursorIndex=0}else{this._cursorIndex=this._revisions.length-(this.currentPageSize*this.currentPageNum)}this.currentPage=this._getCurrentPage();if(this.activeRevisionIndex==-1){if(this._revisions.length<this.currentPageSize){this.activeRevisionIndex=this._revisions.length-1}else{this.activeRevisionIndex=this.currentPageSize-1}this.setActiveRevision(this.activeRevisionIndex);this.facade.sendNotification(cv.model.CommandTypes.APP_READY)}this.fireEvent(cv.model.EventTypes.REVISIONS_LOADED);this._containsLatest=c;this._containsFirst=a;if(this._containsLatest){this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"latest")}else{if(this._containsFirst){this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"first")}else{this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"mid")}}this.activePageIndex++},nextPage:function(){cv.utils.Logger.log("nextPage");cv.utils.Logger.log("this.activePageIndex = "+this.activePageIndex);cv.utils.Logger.log("this.truePageTotal = "+this.truePageTotal);if(this.activePageIndex==1&&this._containsLatest){this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"latest")}else{this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"mid")}this.activePageIndex--;this._cursorIndex=0;this._currentPage=this._getCurrentPage()},previousPage:function(){cv.utils.Logger.log("previousPage");cv.utils.Logger.log("this.activePageIndex = "+this.activePageIndex);cv.utils.Logger.log("this.truePageTotal = "+this.truePageTotal);if(this.activePageIndex<this.truePageTotal-1){this._cursorIndex=this.currentPageSize-1;this.currentPage=this._getCurrentPage();this.activePageIndex++}else{if(this.activePageIndex==this.truePageTotal-1){if(!this._containsFirst){mainView.facade.sendNotification(cv.model.CommandTypes.REQUEST_REV_DATA,{requestor:null,pageNum:(this.truePageTotal+1)})}else{this.facade.sendNotification(cv.model.NotificationTypes.PAGE_CHANGED,"first")}}}},resetPageSize:function(a){if(this.currentPageSize==this.LARGE_PAGE_LENGTH&&this.activeRevisionIndex>6){this._cursorIndex+=3}else{if(this.currentPageSize==this.LARGE_PAGE_LENGTH&&this.activeRevisionIndex<4){this._cursorIndex=0;this.currentPageSize=a}else{if(this.currentPageSize==this.SMALL_PAGE_LENGTH){this._cursorIndex=0;this.currentPageSize=a}}}this.currentPage=this._getCurrentPage();this.currentPageSize=a;this.activeRevisionIndex=this._getNewActiveIndex()},_getCurrentPage:function(){var b=[];for(var a=this._cursorIndex;a<this._cursorIndex+this.currentPageSize;a++){if(a>this._revisions.length-1){break}b.push(this._revisions[a])}return b},_addRevisionGlyphs:function(c){for(var a=0;a<c.length;a++){if(!this._authors[c[a].author]){if(this._colorIndex==this._colors.length-1){this._colorIndex=0}else{this._colorIndex++}this._authors[c[a].author]={stroke:this._colors[this._colorIndex].stroke,fill:this._colors[this._colorIndex].fill}}c[a].stroke=this._authors[c[a].author].stroke;c[a].fill=this._authors[c[a].author].fill;var b=new cv.view.RevisionGlyph(c[a],this.viewportWidth);c[a].glyph=b}return c},_getNewActiveIndex:function(){for(var a=0;a<this.currentPage.length;a++){if(this._activeRevision==this.currentPage[a]){return a}}return this.currentPage.length-1},getCurrentEntryByName:function(a){for(var b=0;b<this._activeRevision.entries.length;b++){var c=this._activeRevision.entries[b];if(a==c.name){return c;break}}return null}});cv.model.RepoDataProxy.entriesAreSimilar=function(b,a){if(b.path==a.path){return true}else{return false}};cv.model.RepoDataProxy.NAME="RepoDataProxy";cv.model.RepoDataProxy.NUM_GLYPHS_TO_SHOW=7;cv.model.Revision=new Class({vcs:null,identifier:null,annotation:null,dateStr:null,commitTime:null,author:null,stroke:null,fill:null,entries:null,treeURL:null,glyph:null,});cv.model.ServiceRequestConfig=new Class({type:null,domain:null,method:null,repoPath:null,pageNum:null,pageSize:null,args:null,isSecure:null,getArgs:function(){return"repoType="+this.type+"&repoPath="+this.repoPath+"&pageNum="+this.pageNum+"&pageSize="+this.pageSize}});cv.model.AnalogPositions=new Object();cv.model.AnalogPositions.ONE_O_CLOCK=300*Math.PI/180;cv.model.AnalogPositions.TWO_O_CLOCK=330*Math.PI/180;cv.model.AnalogPositions.THREE_O_CLOCK=360*Math.PI/180;cv.model.AnalogPositions.FOUR_O_CLOCK=30*Math.PI/180;cv.model.AnalogPositions.FIVE_O_CLOCK=60*Math.PI/180;cv.model.AnalogPositions.SIX_O_CLOCK=90*Math.PI/180;cv.model.AnalogPositions.SEVEN_O_CLOCK=120*Math.PI/180;cv.model.AnalogPositions.EIGHT_O_CLOCK=150*Math.PI/180;cv.model.AnalogPositions.NINE_O_CLOCK=180*Math.PI/180;cv.model.AnalogPositions.TEN_O_CLOCK=210*Math.PI/180;cv.model.AnalogPositions.ELEVEN_O_CLOCK=240*Math.PI/180;cv.model.AnalogPositions.TWELVE_O_CLOCK=270*Math.PI/180;cv.model.CommandTypes=new Object();cv.model.CommandTypes.INITIALIZE_APP="initializeApp";cv.model.CommandTypes.REQUEST_REV_DATA="requestRevData";cv.model.CommandTypes.REQUEST_ENTRY_DATA="requestEntryData";cv.model.CommandTypes.APP_READY="appReady";cv.model.CommandTypes.AUTO_LOAD_CODE_STYLE="autoLoadCodeStyle";cv.model.EntityTypes=new Object();cv.model.EntityTypes.FILE="file";cv.model.EntityTypes.DIRECTORY="directory";cv.model.EntryTypes=new Object();cv.model.EntryTypes.ADDED="added";cv.model.EntryTypes.MODIFIED="modified";cv.model.EntryTypes.DELETED="deleted";cv.model.EventTypes=new Object();cv.model.EventTypes.REPO_TITLE_CHANGE="repoTitleChange";cv.model.EventTypes.ACTIVE_REV_CHANGE="activeRevChange";cv.model.EventTypes.REVISIONS_LOADED="revisionsLoaded";cv.model.EventTypes.CAROUSEL_SLIDE_COMPLETE="carouselSlideComplete";cv.model.EventTypes.NEXT_REVISION="nextRevision";cv.model.EventTypes.PREVIOUS_REVISION="previousRevision";cv.model.EventTypes.NEXT_PAGE="nextPage";cv.model.EventTypes.PREVIOUS_PAGE="previousPage";cv.model.EventTypes.SELECT_BY_INDEX="selectByIndex";cv.model.EventTypes.SLIDE_LEFT="eventTypes.slideLeft";cv.model.EventTypes.SLIDE_RIGHT="eventTypes.slideRight";cv.model.EventTypes.REVISION_RENDER_COMPLETE="eventTypes.revisionRenderComplete";cv.model.EventTypes.ENTRY_SELECTED="eventTypes.entrySelected";cv.model.EventTypes.WINDOW_CLOSE="eventTypes.windowClose";cv.model.EventTypes.RESIZE="eventTypes.resize";cv.model.EventTypes.REQUEST_STAGE_UPDATE="eventTypes.requestStageUpdate";cv.model.NotificationTypes=new Object();cv.model.NotificationTypes.CAROUSEL_SLIDE_COMPLETE="carousel_slide_complete";cv.model.NotificationTypes.SLIDE_LEFT="notificationTypes.slideLeft";cv.model.NotificationTypes.SLIDE_RIGHT="notificationTypes.slideRight";cv.model.NotificationTypes.PREVIOUS_REVISION="notificationTypes.previousRevision";cv.model.NotificationTypes.NEXT_REVISION="notificationTypes.nextRevision";cv.model.NotificationTypes.NEXT_PAGE="notificationTypes.nextPage";cv.model.NotificationTypes.PREVIOUS_PAGE="notificationTypes.previousPage";cv.model.NotificationTypes.PAGE_CHANGED="notificationTypes.pageChanged";cv.model.NotificationTypes.SELECT_BY_INDEX="notificationTypes.selectByIndex";cv.model.NotificationTypes.CHANGE_INDEX="notificationTypes.changeIndex";cv.model.NotificationTypes.CHANGE_RANGE_INDEX="notificationTypes.changeRangeIndex";cv.model.NotificationTypes.INDEX_CHANGED="notificationTypes.indexChanged";cv.model.NotificationTypes.IMMEDIATE_INDEX_UPDATE="notificationTypes.immediateNextUpdate";cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE="glyphRenderingComplete";cv.model.NotificationTypes.SHOW_ENTRY_INFO="showEntryInfo";cv.model.NotificationTypes.SET_MODAL_WINDOW_ACTIVE="setModalWindowActive";cv.model.NotificationTypes.RESIZE="notifications.resize";cv.model.NotificationTypes.REQUEST_STAGE_UPDATE="requestStageUpdate";cv.model.VCSTypes=new Object();cv.model.VCSTypes.SVN="svnVCStype";cv.model.VCSTypes.GIT="gitVCStype";cv.model.DataParser=new Class({});cv.model.DataParser.parseRevisions=function(a){var h=[];for(var f=0;f<a.revisions.length;f++){var c=a.revisions[f];var e=new cv.model.Revision();e.vcs=cv.model.VCSTypes.GIT;e.identifier=c.revision;e.annotation=c.annotation;e.dateStr=c.date;e.commitTime=c.commitTime;e.author=c.author;e.entries=[];if(c.entries.length==0){var g=new cv.model.Entry();g.size=0;g.significance=0;g.name="Git merge";e.entries.push(g)}for(var d=0;d<c.entries.length;d++){var b=c.entries[d];var g=new cv.model.Entry();g.revision=b.revision;g.path=b.path;g.name=b.name;g.size=b.size;g.significance=b.significance;g.status=b.status;g.author=b.author;g.type=b.type;g.kind=b.kind;g.uuid=b.uuid;g.patch=b.patch;g.raw_url=b.raw_url;g.commit_date=b.commit_date;g.commit_time=b.commit_time;g.commit_revision=b.commit_revision;g.sizeHistory=b.sizeHistory;g.authorHistory=b.authorHistory;g.pathHistory=b.pathHistory;g.updateTimeHistory=b.updateTimeHistory;g.revisionHistory=b.revisionHistory;g.uuidHistory=b.uuidHistory;e.entries.push(g)}h.push(e)}h.reverse();return h};cv.model.GitDataParser=new Class({});cv.model.GitDataParser.parseCommits=function(a){cv.utils.Logger.log("commitData "+a.length);var d=[];for(var c=0;c<a.length;c++){var b=new cv.model.Revision();b.vcs=cv.model.VCSTypes.GIT;b.author=a[c].author.name;b.dateStr=a[c].committer.date;b.identifier=a[c].sha;b.annotation=a[c].message;b.treeURL=a[c].tree.url;d.push(b)}return d};cv.model.GitDataParser.parseTrees=function(d){var a=[];for(var b=0;b<d.tree.length;b++){var c=new cv.model.Entry();c.path=d.tree[b].path;c.kind=d.tree[b].type="blob"?cv.model.EntityTypes.FILE:cv.model.EntityTypes.DIRECTORY;c.size=d.tree[b].size;a.push(c)}return a};cv.model.ServiceRequestor=new Class({configObj:null,type:null,domain:null,repoPath:null,httpMethod:null,args:null,pageNum:null,successHandler:null,failureHandler:null,_reqURL:null,_protocol:null,initialize:function(a){this.configObj=a;this.type=a.type;this.domain=a.domain;this.method=a.method;this.pageNum=a.pageNum;this.args=a.getArgs();this.generateUrl()},setPageNum:function(a){this.configObj.pageNum=a;this.args=this.configObj.getArgs()},generateUrl:function(){this.configObj.isSecure?this._protocol="https://":this._protocol="http://";this._reqURL=this.method;if(this.args){this._reqURL+="?"+this.args}},send:function(){cv.utils.Logger.log("Sending service url = "+this._reqURL);var c="Request Handlers must be assigned before calling send.";if(!this.successHandler||!this.failureHandler){throw new Error(c)}var a={url:this._reqURL,onSuccess:this.successHandler,onFailure:this.failureHandler,method:this.httpMethod};var b=new Request.JSON(a).send()},setMethod:function(a){this.httpMethod=a}});cv.view.MainView=new Class({Implements:Events,_BIG_COMMIT_LENGTH:6,_MAX_LICHEN_RADIUS:40,_LINK_PADDING_X:-2,_LINK_PADDING_Y:-2,element:null,facade:null,_stage:null,_canvas:null,_swipeZone:null,_background:null,_startX:null,_currentLinks:[],_currentRevGlyph:null,lineColor:null,initialize:function(a,b){this.element=new Element(a,b);this.lineColor=b;this._swipeZone=document.getElementById("swipeZone");this._addEventListeners();this._canvas=document.getElementById("revGraph");this._canvas.width=Window.getSize().x;this._canvas.height=Window.getSize().y;this._stage=new Stage(this._canvas);this._stage.enableMouseOver(0);this._positionLoader();window.addEvent("resize",this._onResizeHandler.bind(this));if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){window.addEvent("focus",this._onFocus.bind(this))}Ticker.addListener(this);this.facade=cv.ApplicationFacade.getInstance();this.facade.startup(this)},visible:function(a){if(a){$("root").setStyle("visibility","visible")}else{$("root").setStyle("visibility","hidden")}},showLoading:function(a){if(a){$("loading").setStyle("visibility","visible")}else{$("loading").setStyle("visibility","hidden")}},displayLinks:function(a){this._currentRevGlyph=a.glyph;var d=$("linkLayer");var c=this._currentRevGlyph.getMetadata();for(var b=0;b<c.length;b++){var e=this._createLink(c[b]);this._currentLinks.push({link:e,data:c[b]});e=this._positionLink(c[b].radius,c[b].x,c[b].y,e);d.adopt(e)}},clearLinks:function(){if(this._currentLinks.length<1){return}for(var a=0;a<this._currentLinks.length;a++){this._currentLinks[a].link.dispose();this._currentLinks[a].link.destroy()}},_createLink:function(d){var a;if(this._lineColor=="#000"){a="entryLink"}else{a="darkEntryLink"}var b=this;var c=new Element("a",{href:"#","class":a,html:d.name+" <span style='font-size:8px'>&#62;&#62;</span>",events:{click:function(e){b.fireEvent(cv.model.EventTypes.ENTRY_SELECTED,d)}}});return c},_positionLink:function(g,c,b,e){var a=cv.utils.Translate.localToGlobal(c,b);var d;var f;if(g>this._MAX_LICHEN_RADIUS*0.5){d=a.y+6;f=a.x+6}else{d=a.y+g+this._LINK_PADDING_Y;f=a.x+g+this._LINK_PADDING_X}e.setStyles({left:f,top:d});return e},_positionLoader:function(){$("loading").setStyle("top",Window.getSize().y/2-15);$("loading").setStyle("left",Window.getSize().x/2-50)},toElement:function(){return this.element},setStage:function(a){this._stage=a},getStage:function(){return this._stage},tick:function(){this._stage.update()},_addEventListeners:function(){this._swipeZone.addEventListener("touchmove",this._onTouchMove.bind(this),true);this._swipeZone.addEventListener("touchstart",this._onTouchStart.bind(this),true);this._swipeZone.addEventListener("touchend",this._onTouchEnd.bind(this),true)},_onTouchMove:function(a){a.preventDefault();if(event.targetTouches.length>0&event.changedTouches.length==1){if(a.touches.item(0).pageX>this._startX){this.fireEvent(cv.model.EventTypes.SLIDE_RIGHT)}else{if(a.touches.item(0).pageX<this._startX){this.fireEvent(cv.model.EventTypes.SLIDE_LEFT)}}this._startX=-1}},_onTouchStart:function(a){a.preventDefault();this._startX=a.touches.item(0).pageX},_onTouchEnd:function(){},_onResizeHandler:function(){for(var a=0;a<this._currentLinks.length;a++){var b=this._currentLinks[a].link;var c=this._currentLinks[a].data;this._positionLink(c.radius,c.x,c.y,b)}this._positionLoader();this.fireEvent(cv.model.EventTypes.RESIZE)},_onFocus:function(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){}}});cv.view.Bullseye=new Class({diameter:null,_stage:null,_container:null,_stroke:null,_winWidth:function(){return Window.getSize().x},_winHeight:function(){return Window.getSize().y},initialize:function(a,b,c){this._stage=a;this.diameter=b;this._stroke=c;this._draw();window.addEvent("resize",this._onResizeHandler.bind(this))},_onResizeHandler:function(){this._stage.canvas.width=Window.getSize().x;this._stage.canvas.height=Window.getSize().y;for(var a=0;a<this._container.getNumChildren();a++){this._container.getChildAt(a).graphics.clear();this._container.removeChildAt(a)}this._stage.removeChild(this._container);this._draw()},_draw:function(){this._container=new Container();for(var c=0;c<cv.view.Bullseye.NUMBER_OF_CIRCLES;c++){var d=(this.diameter*cv.view.Bullseye.DIAMETER_MULTIPLE)*(c+1);var b=this._winWidth()/2;var a=this._winHeight()/2;var e=new Shape();e.graphics.setStrokeStyle(0.2);e.graphics.beginStroke(this._stroke);e.graphics.drawCircle(0,0,d);e.alpha=1;e.x=b;e.y=a;e.compositeOperation="lighter";this._container.addChild(e)}this._stage.addChild(this._container);this._stage.update()}});cv.view.Bullseye.NUMBER_OF_CIRCLES=9;cv.view.Bullseye.DIAMETER_MULTIPLE=0.1;cv.view.EntryInfoPanel=new Class({Implements:Events,_width:230,_height:100,_stage:null,_canvas:null,_entryVO:null,_sliceColor:null,_changeType:null,_percentageDifference:null,_PIE_CHART_RADIUS:null,_DEGREE_START:270,_DELETE:0,_ADD:1,_MODIFY_ADD:2,_MODIFY_SUBTRACT:3,initialize:function(){this._PIE_CHART_RADIUS=this._height*0.3},draw:function(c,d,f,i,g){this._preRender(i.name);this._entryVO=i;$("entryTitle").set("text",i.name);$("status").set("text",i.status);$("size").set("text",i.size);$("significance").set("text",i.significance);try{$("authors").set("text",i.authorHistory.length);$("changes").set("text",i.uuidHistory.length)}catch(h){cv.utils.Logger.log("EntryInfoPanel : "+h)}$("viewChanges").set("href","https://github.com"+c+"/commit/"+d.identifier);$("closeBtn").addEvent("click",this._onClose.bind(this));var b=cv.utils.Translate.localToGlobal(g.x,g.y);var a=$("entryDetails").getStyle("height");a=a.substring(0,a.length-2);b.y=b.y-(a/2);if(b.y<60){b.y=60}else{if(b.y>Window.getSize().y-a-150){b.y=Window.getSize().y-a-150}}$("entryDetails").setStyles({visibility:"visible",top:b.y,left:b.x});this._renderVisuals(f);this._stage.update()},_preRender:function(a){this._canvas=new Element("canvas");this._width=$("entryVisuals").getStyle("width");this._height=$("entryVisuals").getStyle("height");this._width=this._width.substring(0,this._width.length-2);this._height=this._height.substring(0,this._height.length-2);this._canvas.setStyles({id:a,width:this._width,height:this._height});this._stage=new Stage(this._canvas);this._stage.enableMouseOver(0);$("entryVisuals").grab(this._canvas)},_renderVisuals:function(b){var a=b.getMetadata();cv.utils.Logger.log("metadata "+a.length);if(a.length>1){this._renderGlyph(a)}this._determineChangeType();this._renderPieChart(b)},_renderGlyph:function(d){var a=new Container();for(var b=0;b<d.length;b++){var e=null;if(d[b].name==this._entryVO.name){e="#000"}var c=this._drawCircle(d[b].radius,d[b].fillColor,e);c.x=d[b].x*0.4;c.y=d[b].y*0.4;a.addChild(c)}a.scaleX=0.3;a.scaleY=0.3;a.alpha=0.9;a.x=this._width*0.75;a.y=this._height/2;this._stage.addChild(a)},_renderPieChart:function(d){var c=this._getCurrentEntry(d);var a=new Container();var b=this._drawCircle(this._PIE_CHART_RADIUS,c.fillColor);b.x=0;b.y=0;this._sliceColor=c.fillColor;a.addChild(b);a.x=this._width*0.25;a.y=this._height/2;switch(this._changeType){case this._ADD:break;case this._DELETE:break;case this._MODIFY_ADD:var e=this._drawPieSlice(true);a.addChild(e);break;case this._MODIFY_SUBTRACT:var e=this._drawPieSlice(false);a.addChild(e);break}this._stage.addChild(a)},_determineChangeType:function(){var c=this._entryVO.sizeHistory[this._entryVO.sizeHistory.length-2];var a=this._entryVO.sizeHistory[this._entryVO.sizeHistory.length-1];var b=a-c;cv.utils.Logger.log("previousSize = "+c);cv.utils.Logger.log("newSize = "+a);cv.utils.Logger.log("difference = "+b);cv.utils.Logger.log("this._entryVO.sizeHistory.length = "+this._entryVO.sizeHistory.length);b=Math.abs(b);this._percentageDifference=b/c;if(this._entryVO.sizeHistory.length==1){this._changeType=this._ADD}else{if(a==0){this._changeType=this._DELETE}else{if(c>a){this._changeType=this._MODIFY_SUBTRACT}else{if(c<a){this._changeType=this._MODIFY_ADD}}}}cv.utils.Logger.log("this._changeType = "+this._changeType)},_drawPieSlice:function(b){cv.utils.Logger.log("_drawPieSlice");cv.utils.Logger.log("this._percentageDifference = "+this._percentageDifference);if(b){color="#000"}else{color="#ff0000"}var a=Math.round(this._percentageDifference*360);cv.utils.Logger.log("pieRatio = "+a);var c=new Shape();c=this._drawSliceLine(c,this._DEGREE_START*Math.PI/180,color);c=this._drawSliceLine(c,(this._DEGREE_START+a)*Math.PI/180,color);c.alpha=0.5;return c},_drawSliceLine:function(d,e,c){d.graphics.setStrokeStyle(0.6).beginStroke(c);var b=Math.round(this._PIE_CHART_RADIUS*Math.cos(e));var a=Math.round(this._PIE_CHART_RADIUS*Math.sin(e));cv.utils.Logger.log("startX = "+b);cv.utils.Logger.log("startY = "+a);d.graphics.moveTo(0,0).lineTo(b,a);d.graphics.endStroke();return d},_getTintedColor:function(d,c){if(d.length>6){d=d.substring(1,d.length)}var e=parseInt(d,16);var i=Math.abs(((e>>16)&255)+c);if(i>255){i=i-(i-255)}var h=Math.abs(((e>>8)&255)+c);if(h>255){h=h-(h-255)}var a=Math.abs((e&255)+c);if(a>255){a=a-(a-255)}i=Number(i<0||isNaN(i))?0:((i>255)?255:i).toString(16);if(i.length==1){i="0"+i}h=Number(h<0||isNaN(h))?0:((h>255)?255:h).toString(16);if(h.length==1){h="0"+h}a=Number(a<0||isNaN(a))?0:((a>255)?255:a).toString(16);if(a.length==1){a="0"+a}var f="#"+i+h+a;return f},_getCurrentEntry:function(c){var b=c.getMetadata();for(var a=0;a<b.length;a++){if(this._entryVO.name==b[a].name){return b[a]}}return null},_onClose:function(){$("entryDetails").setStyle("visibility","hidden");if(this._canvas!=null){this._canvas.dispose();this._canvas.destroy();this._canvas=null;this._stage=null}this.fireEvent(cv.model.EventTypes.WINDOW_CLOSE)},_drawCircle:function(a,d,c){cv.utils.Logger.log("drawing circle - radius = "+a);var b=new Shape();if(c){b.graphics.setStrokeStyle(4);b.graphics.beginStroke(c)}b.graphics.beginFill(d);b.graphics.drawCircle(0,0,a);b.alpha=1;b.compositeOperation="source-over";return b}});cv.view.RangeScroller=new Class({Implements:Events,_THRESHOLD_WIDTH:1100,_MAX_RANGE_WIDTH:870,_MIN_RANGE_WIDTH:609,_canvas:null,_stage:null,_width:null,_revisions:null,_lineColor:null,_activeIndex:null,_timeline:null,_timelineContainer:null,_historyDisplayContainer:null,_boundPageNext:null,_boundPagePrev:null,_boundRevNext:null,_boundRevPrev:null,initialize:function(a,b){this._lineColor=b;this._canvas=$("rangeScroller");this._boundRevNext=this._onNext.bind(this);this._boundRevPrev=this._onPrevious.bind(this);this._boundPageNext=this._onPageNext.bind(this);this._boundPagePrev=this._onPagePrevious.bind(this);$("revLinkLayer").addEvent("click",this._onRevSelected.bind(this));$("b_nextBtn").addEvent("click",this._boundRevNext);$("b_prevBtn").addEvent("click",this._boundRevPrev);$("prevPageBtn").addEvent("click",this._boundPagePrev);$("nextPageBtn").addEvent("click",this._boundPageNext);this._width=a;this._canvas.width=this._width;this._canvas.height=240;this._stage=new Stage(this._canvas);this._stage.enableMouseOver(0);Ticker.addListener(this);this._draw()},_draw:function(){this._timelineContainer=new Container();this._timelineContainer.x=0;this._timelineContainer.y=140;var a={viewContainer:this._timelineContainer,width:this._width,color:this._lineColor};this._timeline=new cv.view.Timeline(a);this._stage.addChild(this._timelineContainer)},redraw:function(a){this._revisions=a.currentPage;this._width=this._setWidth();this._clearTimeline();this._canvas.width=this._width;this._draw();this._timeline.renderTimeline(this._revisions);this._timeline.renderHistoryGlyphs(this._revisions);this.setActive(a.currentIndex);this._stage.update()},update:function(a,b){this._activeIndex=a;this._revisions=b;this._timeline.renderTimeline(this._revisions)},setHistoryDisplay:function(a){this._revisions=a;this._timeline.renderHistoryGlyphs(this._revisions)},setActive:function(a){this._timeline.setActive(a)},disableRevNext:function(){$("b_nextBtn").removeEvent("click",this._boundRevNext);$("b_nextBtn").setStyle("opacity","0.4")},disableRevPrev:function(){$("b_prevBtn").removeEvent("click",this._boundRevPrev);$("b_prevBtn").setStyle("opacity","0.4")},enableRevNext:function(){$("b_nextBtn").addEvent("click",this._boundRevNext);$("b_nextBtn").setStyle("opacity","1")},enableRevPrev:function(){$("b_prevBtn").addEvent("click",this._boundRevPrev);$("b_prevBtn").setStyle("opacity","1")},disablePagePrevious:function(){$("prevPageBtn").removeEvent("click",this._boundPagePrev);$("prevPageBtn").setStyle("opacity","0.4")},disablePageNext:function(){$("nextPageBtn").removeEvent("click",this._boundPageNext);$("nextPageBtn").setStyle("opacity","0.4")},activatePaging:function(){$("nextPageBtn").addEvent("click",this._boundPageNext);$("prevPageBtn").addEvent("click",this._boundPagePrev);$("nextPageBtn").setStyle("opacity","1");$("prevPageBtn").setStyle("opacity","1")},_clearTimeline:function(){this._timeline.clear();this._stage.removeChild(this._timelineContainer);this._timelineContainer=null},_setWidth:function(){var a=Window.getSize().x;if(a>this._THRESHOLD_WIDTH){a=this._MAX_RANGE_WIDTH}else{a=this._MIN_RANGE_WIDTH}return a},_onRevSelected:function(d){var c=Window.getSize().x-d.target.clientWidth;var b=d.client.x-c/2;var a=Math.floor(b/this._timeline.REV_WIDTH);this.fireEvent(cv.model.EventTypes.SELECT_BY_INDEX,a)},_onNext:function(){this.fireEvent(cv.model.EventTypes.NEXT_REVISION)},_onPrevious:function(){this.fireEvent(cv.model.EventTypes.PREVIOUS_REVISION)},_onPageNext:function(){cv.utils.Logger.log("_onPageNext");this.fireEvent(cv.model.EventTypes.NEXT_PAGE)},_onPagePrevious:function(){this.fireEvent(cv.model.EventTypes.PREVIOUS_PAGE)},tick:function(){this._stage.update()}});cv.view.RevisionGraph=new Class({Implements:Events,_DEPTH:500,_SLIDE_TIMER_INTERVAL:25,_revGlyphCarousel:null,_revGlyphContainer:null,_revSelector:null,_revSelectorContainer:null,_stage:null,_revisions:null,_periodicalID:null,_activeRevisionIndex:0,_viewportWidth:0,_windowWidth:0,_isAnimating:false,_slideInitialised:false,initialize:function(b,a){this._viewportWidth=a;this._windowWidth=Window.getSize().x;this._stage=b;window.addEvent("resize",this._onResizeHandler.bind(this))},update:function(a,b){this._activeRevisionIndex=a;this._revisions=b;if(!this._revGlyphContainer){this._revGlyphContainer=new Container();this._stage.addChild(this._revGlyphContainer);this._revGlyphCarousel=new cv.view.RevisionGlyphCarousel(this._revGlyphContainer);this._revGlyphCarousel.addEvent(cv.model.EventTypes.CAROUSEL_SLIDE_COMPLETE,this._onCarouselSlideComplete.bind(this));this._revSelectorContainer=new Container();this._revSelector=new cv.view.RevisionSelector(this._revSelectorContainer);this._revSelector.update(this._revisions[a].identifier);this._revSelector.addEvent(cv.model.EventTypes.PREVIOUS_REVISION,this._onSelectPrevious.bind(this));this._revSelector.addEvent(cv.model.EventTypes.NEXT_REVISION,this._onSelectNext.bind(this));this._stage.addChild(this._revSelectorContainer)}this._revGlyphCarousel.draw(a,this._revisions);this.fireEvent(cv.model.EventTypes.REVISION_RENDER_COMPLETE)},changeActiveIndex:function(a){this._activeRevisionIndex=a;this._revGlyphCarousel.draw(a);this._revSelector.update(this._revisions[a].identifier)},redraw:function(a){this._revisions=a.currentPage;this._activeRevisionIndex=a.currentIndex;this._revGlyphCarousel.draw(this._activeRevisionIndex,this._revisions)},slideLeft:function(){this._revGlyphCarousel.slideLeft()},slideRight:function(){this._revGlyphCarousel.slideRight()},_onCarouselSlideComplete:function(){this.fireEvent(cv.model.EventTypes.CAROUSEL_SLIDE_COMPLETE)},_onSelectPrevious:function(){this.fireEvent(cv.model.EventTypes.PREVIOUS_REVISION)},_onSelectNext:function(){this.fireEvent(cv.model.EventTypes.NEXT_REVISION)},_onResizeHandler:function(){if(this._windowWidth==Window.getSize().x){return}this._windowWidth=Window.getSize().x;try{this._revGlyphCarousel.repositionGlyphs();this.fireEvent(cv.model.EventTypes.REQUEST_STAGE_UPDATE)}catch(a){}},});cv.view.RevisionInfoPanel=new Class({initialize:function(){},setRepoPathTitle:function(a){a=a.toUpperCase()},update:function(a){try{$("annotation").set("text",'"'+a.annotation+'"');$("identifier").set("text",a.identifier);$("entriesNum").set("text",a.entries.length);$("author").set("text",a.author);var c=cv.utils.DateParser.parse(a.dateStr);$("time").set("html","&nbsp;"+c.time+"&nbsp;")}catch(b){cv.utils.Logger.log("RevInfoPanel : "+b)}}});cv.view.RevisionSelector=new Class({Implements:Events,_container:null,_revNumDisplay:null,initialize:function(b){this._container=b;var c=$("previousBtn");c.addEvent("click",this._onPreviousClick.bind(this));var a=$("nextBtn");a.addEvent("click",this._onNextClick.bind(this));this._revNumDisplay=$("revNumDisplay")},update:function(a){this._revNumDisplay.innerText=a.slice(0,4)+"..."},_onPreviousClick:function(){cv.utils.Logger.log("click");this.fireEvent(cv.model.EventTypes.PREVIOUS_REVISION)},_onNextClick:function(){cv.utils.Logger.log("click2");this.fireEvent(cv.model.EventTypes.NEXT_REVISION)},_onImgLoaded:function(a){cv.utils.Logger.log(a)}});cv.view.EntryGlyph=new Class({id:null,canvas:null,_parentContainer:null,_circle:null,_entryShadow:null,_entryVO:null,_title:null,_padding:4,_winWidth:function(){return Window.getSize().x},_winHeight:function(){return Window.getSize().y},_bgWidth:0,_radius:0,_ringRadius:0,_offSet:18,_angle:-1,_centerPositionType:"",_stroke:null,_fill:null,initialize:function(b,a){this._entryVO=a.entryVO;this.id=this._entryVO.id;this._bgWidth=a.bgWidth;this._radius=a.radius;this._ringRadius=a.ringRadius-this._offSet;this._angle=a.angle;this._stroke=a.stroke;this._fill=a.fill;this._parentContainer=b;this._draw()},cloneShape:function(){var a=this._drawCircle(this._radius,this._stroke,this._fill,1,true);a=this._positionEntryGlyph(a);return a},getMetadata:function(){return{name:this._entryVO.name,x:this._x,y:this._y,radius:this._radius,strokeColor:this._stroke,fillColor:this._fill}},_draw:function(){this._circle=this._drawCircle(this._radius,this._stroke,this._fill,1,true);this._positionEntryGlyph(this._circle,0);this._parentContainer.addChild(this._circle)},_drawCircle:function(a,f,e,d,b){var c=new Shape();if(b){c.graphics.setStrokeStyle(6);c.graphics.beginStroke(f)}if(e!=null){c.graphics.beginFill(e)}c.graphics.drawCircle(0,0,a);c.alpha=d;c.compositeOperation="source-over";return c},_positionEntryGlyph:function(b,c){if(this._angle==0){b.x=0+c;b.y=0+c}else{var a=this._getPositionVector(this._angle,this._ringRadius);b.x=a.x+c;b.y=a.y+c}this._x=b.x;this._y=b.y},_getPositionVector:function(c,a){var b=new Object();if(c>-1){b.x=Math.round(a*Math.cos(c));b.y=Math.round(a*Math.sin(c))}else{b.x=0;b.y=0}return b},setActive:function(){cv.utils.Logger.log("SETTING ACTIVE");this._entryShadow=this._drawCircle(this._radius,"#162433","#162433",0.8,false);this._entryShadow.shadow=new Shadow(this._fill,0,0,80);this._positionEntryGlyph(this._entryShadow,0);this._parentContainer.addChildAt(this._entryShadow,0);this._parentContainer.addChild(this._title)},clearActive:function(){this._parentContainer.removeChild(this._entryShadow);this._parentContainer.removeChild(this._title)}});cv.view.GlyphRenderer=new Class({});cv.view.GlyphRenderer.sortEntries=function(g,j){if(g==null||g.length<1){cv.utils.Logger.log("Error : null entries object");return}else{cv.utils.Logger.log("entries.length = "+g.length)}var a=g[0].significance;var c=3;var h=9;var m=6;var l=c+h+m;var f=a/c;var o=a/h;var n=a/m;var b;if(g.length>l){b=l}else{b=g.length}for(var e=0;e<b;e++){var d;var k=g[e];if(k.significance>=f&&j.CENTER_RING.entries.length<c){d=j.CENTER_RING}else{if(k.significance>=o&&j.FIRST_RING.entries.length<h){d=j.FIRST_RING}else{if(k.significance>=n&&j.SECOND_RING.entries.length<m){d=j.SECOND_RING}else{d=j.THIRD_RING}}}d.entries.push(k);alphabetizePath=function(p,i){if(p.path==i.path){return 0}else{return(p.path<i.path)?-1:1}};d.entries.sort(alphabetizePath)}};cv.view.GlyphRenderer.setCenterAngles=function(a,c,b){if(b.entries.length==2){if(c>1){if(cv.model.RepoDataProxy.entriesAreSimilar(a[0],a[1])){if(cv.model.RepoDataProxy.entriesAreSimilar(c[0],c[c.length-1])){b.entries[0].angle=cv.model.AnalogPositions.TWELVE_O_CLOCK;b.entries[1].angle=cv.model.AnalogPositions.EIGHT_O_CLOCK;return cv.view.GlyphRenderer.TWELVE_AND_EIGHT}else{b.entries[0].angle=cv.model.AnalogPositions.TWELVE_O_CLOCK;b.entries[1].angle=cv.model.AnalogPositions.FOUR_O_CLOCK;return cv.view.GlyphRenderer.TWELVE_AND_FOUR}}else{b.entries[0].angle=cv.model.AnalogPositions.NINE_O_CLOCK;b.entries[1].angle=cv.model.AnalogPositions.THREE_O_CLOCK;return cv.view.GlyphRenderer.NINE_AND_THREE}}else{b.entries[0].angle=cv.model.AnalogPositions.TWELVE_O_CLOCK;b.entries[1].angle=cv.model.AnalogPositions.FOUR_O_CLOCK;return cv.view.GlyphRenderer.TWELVE_AND_FOUR}}else{b.entries[0].angle=cv.model.AnalogPositions.FOUR_O_CLOCK;b.entries[1].angle=cv.model.AnalogPositions.EIGHT_O_CLOCK;b.entries[2].angle=cv.model.AnalogPositions.TWELVE_O_CLOCK;return cv.view.GlyphRenderer.ALL_THREE}};cv.view.GlyphRenderer.setFirstRingAngles=function(a,e,d,c){var g=[cv.model.AnalogPositions.ONE_O_CLOCK,cv.model.AnalogPositions.TWO_O_CLOCK,cv.model.AnalogPositions.THREE_O_CLOCK,cv.model.AnalogPositions.EIGHT_O_CLOCK,cv.model.AnalogPositions.NINE_O_CLOCK,cv.model.AnalogPositions.ELEVEN_O_CLOCK,cv.model.AnalogPositions.TEN_O_CLOCK,cv.model.AnalogPositions.TWELVE_O_CLOCK,cv.model.AnalogPositions.FOUR_O_CLOCK];var f=[cv.model.AnalogPositions.ELEVEN_O_CLOCK,cv.model.AnalogPositions.TEN_O_CLOCK,cv.model.AnalogPositions.NINE_O_CLOCK,cv.model.AnalogPositions.FOUR_O_CLOCK,cv.model.AnalogPositions.ONE_O_CLOCK,cv.model.AnalogPositions.TWO_O_CLOCK,cv.model.AnalogPositions.THREE_O_CLOCK,cv.model.AnalogPositions.TWELVE_O_CLOCK,cv.model.AnalogPositions.EIGHT_O_CLOCK];if(a.length>0){var b=cv.model.RepoDataProxy.entriesAreSimilar(a[0],e[0])}if(c==cv.view.GlyphRenderer.SINGLE_CENTER){cv.view.GlyphRenderer.setAnglesPerOrder(g,d)}else{if(c==cv.view.GlyphRenderer.NINE_AND_THREE){cv.view.GlyphRenderer.setAnglesPerOrder(f,d)}else{if(c==cv.view.GlyphRenderer.TWELVE_AND_EIGHT&&b){cv.view.GlyphRenderer.setAnglesPerOrder(g,d)}else{if(c==cv.view.GlyphRenderer.TWELVE_AND_EIGHT&&!b){cv.view.GlyphRenderer.setAnglesPerOrder(g,d)}else{if(c==cv.view.GlyphRenderer.TWELVE_AND_FOUR&&b){cv.view.GlyphRenderer.setAnglesPerOrder(g,d)}else{if(c==cv.view.GlyphRenderer.TWELVE_AND_FOUR&&!b){cv.view.GlyphRenderer.setAnglesPerOrder(f,d)}else{if(c==cv.view.GlyphRenderer.ALL_THREE){cv.view.GlyphRenderer.setAnglesPerOrder(g,d)}}}}}}}};cv.view.GlyphRenderer.setAnglesPerOrder=function(a,c){for(var b in c.entries){c.entries[b].angle=a[b]}};cv.view.GlyphRenderer.setOuterRingAngles=function(a){var b=[cv.model.AnalogPositions.TEN_O_CLOCK,cv.model.AnalogPositions.NINE_O_CLOCK,cv.model.AnalogPositions.EIGHT_O_CLOCK,cv.model.AnalogPositions.TWO_O_CLOCK,cv.model.AnalogPositions.THREE_O_CLOCK,cv.model.AnalogPositions.FOUR_O_CLOCK];cv.view.GlyphRenderer.setAnglesPerOrder(b,a)};cv.view.GlyphRenderer.SINGLE_CENTER="singleCenter";cv.view.GlyphRenderer.NINE_AND_THREE="nineAndThree";cv.view.GlyphRenderer.TWELVE_AND_FOUR="twelveAndFour";cv.view.GlyphRenderer.TWELVE_AND_EIGHT="twelveAndEight";cv.view.GlyphRenderer.ALL_THREE="allThree";cv.view.RevisionGlyph=new Class({viewContainer:null,allEntryGlyphs:[],_MAX_LICHEN_RADIUS:40,_MIN_LICHEN_RADIUS:14,_number:null,_anchorIndex:null,_positionIndex:null,_curvePosition:null,_isAnimating:null,_active:false,_viewportWidth:0,_centerPositionType:"",_revision:null,_rings:null,_addedCount:0,initialize:function(b,a){this._revision=b;this.viewContainer=new Container();this._viewportWidth=a;this._draw()},_draw:function(){this._buildRings();cv.view.GlyphRenderer.sortEntries(this._revision.entries,this._rings);this._applyLayoutRules()},_applyLayoutRules:function(){this._rings.CENTER_RING.container=new Container();this.viewContainer.addChild(this._rings.CENTER_RING.container);if(this._rings.CENTER_RING.entries.length==1){this._centerPositionType=cv.view.GlyphRenderer.SINGLE_CENTER;this._rings.CENTER_RING.entries[0].angle=0;this._createEntryGlyphs(this._rings.CENTER_RING)}else{this._centerPositionType=cv.view.GlyphRenderer.setCenterAngles(this._revision.entries,this._rings.FIRST_RING.entries,this._rings.CENTER_RING);this._createEntryGlyphs(this._rings.CENTER_RING)}if(this._rings.FIRST_RING.entries.length>0){this._positionRingEntries("FIRST_RING")}if(this._rings.SECOND_RING.entries.length>0){this._positionRingEntries("SECOND_RING")}if(this._rings.THIRD_RING.entries.length>0){this._positionRingEntries("THIRD_RING")}},_positionRingEntries:function(a){this._rings[a].container=new Container();if(a=="FIRST_RING"){cv.view.GlyphRenderer.setFirstRingAngles(this._revision.entries,this._rings.CENTER_RING.entries,this._rings.FIRST_RING,this._centerPositionType)}else{cv.view.GlyphRenderer.setOuterRingAngles(this._rings[a])}this._createEntryGlyphs(this._rings[a]);this.viewContainer.addChild(this._rings[a].container)},_createEntryGlyphs:function(b){for(var d=0;d<b.entries.length;d++){var e=b.entries[d];var a=e.size/100+this._MIN_LICHEN_RADIUS;if(a>this._MAX_LICHEN_RADIUS){a=this._MAX_LICHEN_RADIUS}var c=new cv.view.EntryGlyph(b.container,{entryVO:e,bgWidth:a*2,radius:a,ringRadius:b.radius,angle:e.angle,stroke:this._revision.stroke,fill:this._revision.fill});b.glyphs.push(c);this.allEntryGlyphs.push(c)}},_buildRings:function(){this._rings=[];this._rings.CENTER_RING={type:"CENTER_RING",entries:[],glyphs:[],radius:this._viewportWidth*0.12};this._rings.FIRST_RING={type:"FIRST_RING",entries:[],glyphs:[],radius:this._viewportWidth*0.22};this._rings.SECOND_RING={type:"SECOND_RING",entries:[],glyphs:[],radius:this._viewportWidth*0.32};this._rings.THIRD_RING={type:"THIRD_RING",entries:[],glyphs:[],radius:this._viewportWidth*0.42}},_clearEntries:function(){for(var c in this._rings){if(this._rings.hasOwnProperty(c)){for(var a=0;a<this._rings[c].glyphs.length;a++){var d=this._rings[c].glyphs[a];var b=d.canvas.getContext("2d");b.clearRect(0,0,this._winWidth(),this._winHeight())}}}},getMetadata:function(){var c=[];var e=this._rings.CENTER_RING.glyphs;for(var b=0;b<e.length;b++){c.push(e[b].getMetadata())}var d=this._rings.FIRST_RING.glyphs;for(var a=0;a<d.length;a++){c.push(d[a].getMetadata())}var f=this._rings.SECOND_RING.glyphs;for(var a=0;a<f.length;a++){c.push(f[a].getMetadata())}var g=this._rings.THIRD_RING.glyphs;for(var a=0;a<g.length;a++){c.push(g[a].getMetadata())}return c},setActive:function(){for(var b in this._rings){if(this._rings.hasOwnProperty(b)){for(var a=0;a<this._rings[b].glyphs.length;a++){var c=this._rings[b].glyphs[a];c.setActive()}}}},clearActive:function(){for(var b in this._rings){if(this._rings.hasOwnProperty(b)){for(var a=0;a<this._rings[b].glyphs.length;a++){var c=this._rings[b].glyphs[a];c.clearActive()}}}}});cv.view.RevisionGlyphCarousel=new Class({Implements:Events,_revisions:null,_container:null,_activeRevision:0,_activeIndex:-1,_positionGlyphs:[],_positionAnchors:null,_currentPositionStruct:null,_startPositionStruct:null,_endPositionStruct:null,_numPositions:5,_completeCount:0,_tweenCount:0,_slideLeft:null,_slideRight:null,_winWidth:function(){return Window.getSize().x},_winHeight:function(){return Window.getSize().y},initialize:function(a){this._container=a},draw:function(a,b){if(this._container.getNumChildren()>0){this._resetView()}if(b){this._revisions=b}if(this._positionAnchors){this._clearPositionAnchors()}this._positionAnchors=[];this._generatePositionAnchors();this._generatePositionStructures();this._layoutGlyphs(a,false);if(this._activeIndex!=a){this._activeIndex=a;this._revisions[this._activeIndex].glyph.setActive()}},repositionGlyphs:function(){this._clearPositionAnchors();this._generatePositionAnchors();for(var a=0;a<this._numPositions;a++){var d=this._currentPositionStruct[a];try{if(this._activeIndex+d.offset>this._revisions.length-1||this._activeIndex+d.offset<0){break}var b=this._revisions[this._activeIndex+d.offset].glyph.viewContainer;b.x=this._positionAnchors[d.name].x;b.y=this._positionAnchors[d.name].y;this._positionAnchors[d.name].glyph=b}catch(c){cv.utils.Logger.log("bailing out because "+c);break}}},slideLeft:function(){if(this._activeIndex>-1){this._revisions[this._activeIndex].glyph.clearActive()}this._tweenGlyph(this._fromLeft)},slideRight:function(){if(this._activeIndex>-1){this._revisions[this._activeIndex].glyph.clearActive()}this._tweenGlyph(this._fromRight)},_layoutGlyphs:function(d){if(d<2){this._currentPositionStruct=this._endPositionStruct}else{this._currentPositionStruct=this._startPositionStruct}for(var a=0;a<this._numPositions;a++){var f=this._currentPositionStruct[a];try{var b=this._positionGlyph(f.name,this._revisions[d+f.offset].glyph.viewContainer)}catch(c){break}this._positionAnchors[f.name].glyph=b;this._container.addChild(b)}},_positionGlyph:function(a,b){b.x=this._positionAnchors[a].x;b.y=this._positionAnchors[a].y;b.alpha=this._positionAnchors[a].alpha;b.scaleX=this._positionAnchors[a].scale;b.scaleY=this._positionAnchors[a].scale;return b},_generatePositionAnchors:function(){this._positionAnchors.start={x:this._winWidth()*0.05,y:this._winHeight()*0.5,alpha:0.4,scale:0.2,glyph:null};this._positionAnchors.leftMid={x:this._winWidth()*0.2,y:this._winHeight()*0.5,alpha:0.4,scale:0.6,glyph:null};this._positionAnchors.center={x:this._winWidth()/2,y:this._winHeight()/2,alpha:0.6,scale:1,glyph:null};this._positionAnchors.rightMid={x:this._winWidth()*0.8,y:this._winHeight()*0.5,alpha:0.4,scale:0.6,glyph:null};this._positionAnchors.end={x:this._winWidth()*0.95,y:this._winHeight()*0.5,alpha:0.4,scale:0.2,glyph:null}},_clearPositionAnchors:function(){this._positionAnchors.start=null;this._positionAnchors.leftMid=null;this._positionAnchors.center=null;this._positionAnchors.rightMid=null;this._positionAnchors.end=null},_generatePositionStructures:function(){this._startPositionStruct=[{name:"center",offset:0},{name:"leftMid",offset:-1},{name:"start",offset:-2},{name:"rightMid",offset:+1},{name:"end",offset:+2}];this._endPositionStruct=[{name:"center",offset:0},{name:"rightMid",offset:+1},{name:"end",offset:+2},{name:"leftMid",offset:-1},{name:"start",offset:-2}];this._fromLeft=["end","rightMid","center","leftMid","start"];this._fromRight=["start","leftMid","center","rightMid","end"]},_tweenGlyph:function(c){var d=this._determineStart(c[0]);for(var b=d;b<this._container.getNumChildren();b++){if(this._positionAnchors[c[b]].glyph!=null&&c.length>b+1){this._tweenCount++;var a=Tween.get(this._positionAnchors[c[b]].glyph,{loop:false,useTicks:false}).to({x:this._positionAnchors[c[b+1]].x,y:this._positionAnchors[c[b+1]].y,alpha:this._positionAnchors[c[b+1]].alpha,scaleX:this._positionAnchors[c[b+1]].scale,scaleY:this._positionAnchors[c[b+1]].scale},400,Ease.circOut).call(this._onAnimationComplete.bind(this))}}},_determineStart:function(a){var b=0;if(this._activeIndex==0&&a=="start"){b=2}else{if(this._activeIndex==1&&a=="start"){b=1}else{if(this._activeIndex==2&&a=="start"){b=0}else{if(this._activeIndex==3&&a=="start"){b=0}else{if(this._activeIndex==this._revisions.length-2&&a=="end"){b=1}}}}}return b},_onAnimationComplete:function(){this._completeCount++;if(this._completeCount==this._tweenCount){this._resetView();this.fireEvent(cv.model.EventTypes.CAROUSEL_SLIDE_COMPLETE)}},_resetView:function(){this._revisions[this._activeIndex].glyph.clearActive();this._clearGlyphs();this._completeCount=0;this._tweenCount=0},_clearGlyphs:function(){var b=this._container.getNumChildren();for(var a=0;a<b;a++){this._container.removeChildAt(0)}},});cv.view.Timeline=new Class({REV_WIDTH:87,_REV_HEIGHT:22,_BRACKET_HEIGHT:40,width:null,_length:0,_color:"#000",_container:null,_dividers:null,_revisions:null,_glyphContainer:null,_glyphIcons:[],_activeContainer:null,_activeTime:null,_preciseTime:null,activeIndex:null,initialize:function(a){this._container=a.viewContainer;this.width=a.width;this._color=a.color;this._draw()},_draw:function(){this._renderBracket()},_renderBracket:function(){var a=new Shape();a.graphics.setStrokeStyle(0.6).beginStroke(this._color);a.graphics.moveTo(0,0).lineTo(0,this._BRACKET_HEIGHT).lineTo(this.width,this._BRACKET_HEIGHT).lineTo(this.width,0);a.graphics.endStroke();this._container.addChild(a)},_renderDividers:function(b){this._dividers=new Shape();this._dividers.graphics.setStrokeStyle(0.3).beginStroke(this._color);for(var a=1;a<b;a++){this._dividers.graphics.moveTo(this.REV_WIDTH*a,this._BRACKET_HEIGHT-this._REV_HEIGHT);this._dividers.graphics.lineTo(this.REV_WIDTH*a,this._BRACKET_HEIGHT)}this._dividers.graphics.endStroke();this._container.addChild(this._dividers)},setActive:function(d){if(!this._activeContainer){this._initActiveContainer()}var h=cv.utils.DateParser.parse(this._revisions[d].dateStr);var f=cv.utils.DateParser.getGregorianDay(this._revisions[d].dateStr);var c=cv.utils.DateParser.getGregorianMonth(this._revisions[d].dateStr);var b=f+" "+c+" "+h.day+"\n"+h.year;this._activeTime.initialize(b,"12px Arial",this._color);this._preciseTime.initialize(h.time,"12px Arial",this._color);this._activeContainer.x=this.REV_WIDTH*d+4;this._activeContainer.y=-76;if(this.activeIndex!=null){this._glyphContainer.getChildAt(this.activeIndex).shadow=null;this._glyphContainer.getChildAt(this.activeIndex).alpha=0.9}this.activeIndex=d;var a=this._revisions[this.activeIndex];var g=a.glyph;var e=g.getMetadata();this._glyphContainer.getChildAt(this.activeIndex).shadow=new Shadow(e[0].fillColor,2,2,20);this._glyphContainer.getChildAt(this.activeIndex).alpha=1;this._container.addChild(this._activeContainer)},_initActiveContainer:function(){this._activeContainer=new Container();this._activeTime=new Text("","12px Arial",this._color);this._activeTime.textBaseline="top";this._preciseTime=new Text("","12px Arial",this._color);this._preciseTime.textBaseline="top";this._preciseTime.y=100;var a=new Shape();a.graphics.setStrokeStyle(0.8).beginStroke(this._color);a.graphics.moveTo(-4,70);a.graphics.lineTo(-4,150);a.graphics.endStroke();this._activeContainer.addChild(this._preciseTime);this._activeContainer.addChild(this._activeTime);this._activeContainer.addChild(a)},renderTimeline:function(k){this._revisions=k;for(var d=0;d<this._revisions.length;d++){var g=cv.utils.DateParser.parse(this._revisions[d].dateStr);var i=g.time.split(":");var a=i[0]+":"+i[1];var c=new Text(a,"12px Arial",this._color);c.textBaseline="top";c.x=this.REV_WIDTH*d+4;c.y=24;this._container.addChild(c);if(d==0||cv.utils.DateParser.dateIsDifferent(this._revisions[d-1].dateStr,this._revisions[d].dateStr)){var e=cv.utils.DateParser.getGregorianDay(this._revisions[d].dateStr);var h=cv.utils.DateParser.getGregorianMonth(this._revisions[d].dateStr);var b=e+" "+h+" "+g.day;var f=new Text(b,"12px Arial",this._color);f.textBaseline="top";f.x=this.REV_WIDTH*d+4;f.y=42;this._container.addChild(f)}}this._renderDividers(this._revisions.length)},renderHistoryGlyphs:function(g){if(this._glyphContainer){this._clearGlyphs()}this._glyphContainer=new Container();this._revisions=g;for(var e=0;e<g.length;e++){var f=g[e].glyph;var d=f.getMetadata();var a=new Container();for(var b=0;b<d.length;b++){var c=this._drawCircle(d[b].radius,d[b].stroke,d[b].fillColor);c.x=d[b].x*0.4;c.y=d[b].y*0.4;a.addChild(c)}a.scaleX=0.3;a.scaleY=0.3;a.alpha=0.7;a.x=e*this.REV_WIDTH+(this.REV_WIDTH/2);a.y=-12;this._glyphContainer.addChild(a)}this._container.addChild(this._glyphContainer)},clear:function(){for(var a=0;a<this._container.getNumChildren();a++){var b=this._container.removeChildAt(a);b=null}},_clearGlyphs:function(){for(var a=0;a<this._glyphContainer.getNumChildren();a++){var b=this._glyphContainer.removeChildAt(a);b=null}},_drawCircle:function(a,d,c){var b=new Shape();b.graphics.setStrokeStyle(3);b.graphics.beginStroke("#ffffff");b.graphics.beginFill(c);b.graphics.drawCircle(0,0,a);b.alpha=0.6;b.compositeOperation="source-over";return b}});cv.view.ApplicationMediator=new Class({Extends:Mediator,keyboard:null,self:null,_THRESHOLD_WIDTH:1100,_LARGE_RANGE_SCROLLER_WIDTH:870,_SMALL_RANGE_SCROLLER_WIDTH:609,listControlLength:null,_configProxy:null,_repoDataProxy:null,_isSliding:false,_newActiveRevIndex:null,_revisionGlyphs:null,_activeRevisionGlyph:null,_appIsActive:true,_numAnimatorsCompleted:0,initialize:function(a){this.parent(cv.view.ApplicationMediator.NAME,a);this._configProxy=this.facade.retrieveProxy(cv.model.ConfigProxy.NAME);this._repoDataProxy=this.facade.retrieveProxy(cv.model.RepoDataProxy.NAME);this.viewComponent.addEvent(cv.model.EventTypes.SLIDE_RIGHT,this._onArrowLeft.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.SLIDE_LEFT,this._onArrowRight.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.ENTRY_SELECTED,this._onEntrySelected.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.RESIZE,this._onResize.bind(this));this.listControlLength=this._getRangeScrollerLength()},listNotificationInterests:function(){return[cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE,cv.model.NotificationTypes.CAROUSEL_SLIDE_COMPLETE,cv.model.NotificationTypes.NEXT_REVISION,cv.model.NotificationTypes.PREVIOUS_REVISION,cv.model.NotificationTypes.NEXT_PAGE,cv.model.NotificationTypes.PREVIOUS_PAGE,cv.model.NotificationTypes.SELECT_BY_INDEX,cv.model.NotificationTypes.SET_MODAL_WINDOW_ACTIVE,cv.model.NotificationTypes.INDEX_CHANGED,cv.model.NotificationTypes.REQUEST_STAGE_UPDATE]},handleNotification:function(a){switch(a.name){case cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE:if(!this._appIsActive){return}this._displayLinks();this.viewComponent.showLoading(false);this.viewComponent.tick();Ticker.setPaused(true);this.viewComponent.visible(true);break;case cv.model.NotificationTypes.CAROUSEL_SLIDE_COMPLETE:if(!this._appIsActive){return}this._isSliding=false;this._repoDataProxy.setActiveRevision(this._newActiveRevIndex);this._displayLinks();Ticker.setPaused(true);break;case cv.model.NotificationTypes.NEXT_REVISION:if(!this._appIsActive){return}if(this._isSliding){return}this._selectNext();break;case cv.model.NotificationTypes.PREVIOUS_REVISION:if(!this._appIsActive){return}if(this._isSliding){return}this._selectPrevious();break;case cv.model.NotificationTypes.NEXT_PAGE:this.viewComponent.visible(false);this.viewComponent.showLoading(true);this._repoDataProxy.nextPage();this.viewComponent.clearLinks();break;case cv.model.NotificationTypes.PREVIOUS_PAGE:this.viewComponent.visible(false);this.viewComponent.showLoading(true);this._repoDataProxy.previousPage();this.viewComponent.clearLinks();break;case cv.model.NotificationTypes.SELECT_BY_INDEX:if(!this._appIsActive){return}this._numAnimatorsCompleted=0;this.viewComponent.clearLinks();this._newActiveRevIndex=a.getBody();Ticker.setPaused(false);this.facade.sendNotification(cv.model.NotificationTypes.CHANGE_INDEX,this._newActiveRevIndex);break;case cv.model.NotificationTypes.SET_MODAL_WINDOW_ACTIVE:this._appIsActive=a.getBody();break;case cv.model.NotificationTypes.INDEX_CHANGED:this._numAnimatorsCompleted++;if(this._numAnimatorsCompleted>1){this.viewComponent.tick();Ticker.setPaused(true);this._repoDataProxy.setActiveRevision(this._newActiveRevIndex);this._displayLinks();this._numAnimatorsCompleted=0}break;case cv.model.NotificationTypes.REQUEST_STAGE_UPDATE:this.viewComponent.tick();break;default:cv.utils.Logger.log("App Mediator : unhandled notification")}},setKeyboard:function(a){this.keyboard=a;this.keyboard.addEvents({left:this._onArrowLeft.bind(this),right:this._onArrowRight.bind(this),up:this._onArrowUp.bind(this),down:this._onArrowDown.bind(this)});this.keyboard.activate()},_requestData:function(){cv.utils.Logger.log("requestData")},_displayLinks:function(){var a=this._repoDataProxy.activeRevisionIndex;var b=this._repoDataProxy.currentPage[a];this.viewComponent.displayLinks(b)},_selectNext:function(){if(this._repoDataProxy.activeRevisionIndex<this._repoDataProxy.currentPage.length-1){Ticker.setPaused(false);this.viewComponent.clearLinks();this._newActiveRevIndex=this._repoDataProxy.activeRevisionIndex+1;this.facade.sendNotification(cv.model.NotificationTypes.SLIDE_LEFT);this.facade.sendNotification(cv.model.NotificationTypes.CHANGE_RANGE_INDEX,this._newActiveRevIndex);this._isSliding=true}},_selectPrevious:function(){if(this._repoDataProxy.activeRevisionIndex>0){Ticker.setPaused(false);this.viewComponent.clearLinks();this._newActiveRevIndex=this._repoDataProxy.activeRevisionIndex-1;this.facade.sendNotification(cv.model.NotificationTypes.SLIDE_RIGHT);this.facade.sendNotification(cv.model.NotificationTypes.CHANGE_RANGE_INDEX,this._newActiveRevIndex);this._isSliding=true}},_onArrowLeft:function(){if(this._isSliding||!this._appIsActive){return}this._selectPrevious()},_onArrowRight:function(){if(this._isSliding||!this._appIsActive){return}this._selectNext()},_onArrowUp:function(){cv.utils.Logger.log("arrowUp")},_onArrowDown:function(){cv.utils.Logger.log("arrowDown")},_onEntrySelected:function(a){this.facade.sendNotification(cv.model.NotificationTypes.SHOW_ENTRY_INFO,{revGlyph:this._repoDataProxy.currentPage[this._repoDataProxy.activeRevisionIndex].glyph,entryVO:this._repoDataProxy.getCurrentEntryByName(a.name),data:a})},_requestPage:function(a){mainView.facade.sendNotification(cv.model.CommandTypes.REQUEST_REV_DATA,null,a)},_onResize:function(){var b=this._getRangeScrollerLength();if(this.listControlLength!=b){this.listControlLength=b;this._repoDataProxy.resetPageSize(this.listControlLength);var a={currentPage:this._repoDataProxy.currentPage,currentIndex:this._repoDataProxy.activeRevisionIndex};this.facade.sendNotification(cv.model.NotificationTypes.RESIZE,a)}},_getPageState:function(a){if(a==0){}},_getRangeScrollerLength:function(){var a=Window.getSize().x;var b;if(a>this._THRESHOLD_WIDTH){b=this._repoDataProxy.LARGE_PAGE_LENGTH}else{b=this._repoDataProxy.SMALL_PAGE_LENGTH}return b},getRangeScrollerWidth:function(){if(this.listControlLength==this._repoDataProxy.LARGE_PAGE_LENGTH){return this._LARGE_RANGE_SCROLLER_WIDTH}else{return this._SMALL_RANGE_SCROLLER_WIDTH}},});cv.view.ApplicationMediator.NAME="ApplicationMediator";cv.view.EntryInfoMediator=new Class({Extends:Mediator,_repoDataProxy:null,_entryVO:null,initialize:function(a){this.parent(cv.view.EntryInfoMediator.NAME,a);this.viewComponent.addEvent(cv.model.EventTypes.WINDOW_CLOSE,this._onWindowClose.bind(this));this._repoDataProxy=this.facade.retrieveProxy(cv.model.RepoDataProxy.NAME)},listNotificationInterests:function(){return[cv.model.NotificationTypes.SHOW_ENTRY_INFO]},handleNotification:function(b){switch(b.name){case cv.model.NotificationTypes.SHOW_ENTRY_INFO:this._entryVO=b.getBody().entryVO;var a=b.getBody().revGlyph;var c=this._entryVO.name.split(".")[1];this.viewComponent.draw(this._repoDataProxy.currentRepoPath,this._repoDataProxy.getActiveRevision(),a,this._entryVO,b.getBody().data);this.facade.sendNotification(cv.model.NotificationTypes.SET_MODAL_WINDOW_ACTIVE,false);break;default:cv.utils.Logger.log("EntryInfoMediator : unhandled notification");break}},_onWindowClose:function(){this.facade.sendNotification(cv.model.NotificationTypes.SET_MODAL_WINDOW_ACTIVE,true)},_onStyleScriptLoaded:function(){cv.utils.Logger.log("script loaded")}});cv.view.EntryInfoMediator.NAME="EntryInfoMediator";cv.view.RangeScrollerMediator=new Class({Extends:Mediator,_repoDataProxy:null,_rendered:false,initialize:function(a){this.parent(cv.view.RangeScrollerMediator.NAME,a)},setData:function(a){this._repoDataProxy=a;this._repoDataProxy.addEvent(cv.model.EventTypes.REVISIONS_LOADED,this._onRevisionsLoaded.bind(this));this._repoDataProxy.addEvent(cv.model.EventTypes.ACTIVE_REV_CHANGE,this._onActiveRevChanged.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.PREVIOUS_REVISION,this._onSelectPrevious.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.NEXT_REVISION,this._onSelectNext.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.NEXT_PAGE,this._onSelectNextPage.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.PREVIOUS_PAGE,this._onSelectPreviousPage.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.SELECT_BY_INDEX,this._onSelectByIndex.bind(this))},listNotificationInterests:function(){return[cv.model.NotificationTypes.CHANGE_INDEX,cv.model.NotificationTypes.CHANGE_RANGE_INDEX,cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE,cv.model.NotificationTypes.RESIZE,cv.model.NotificationTypes.PAGE_CHANGED]},handleNotification:function(c){switch(c.name){case cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE:cv.utils.Logger.log("RangeScroller - Render complete");this.viewComponent.setHistoryDisplay(this._repoDataProxy.currentPage);if(this._rendered){var a={currentPage:this._repoDataProxy.currentPage,currentIndex:this._repoDataProxy.activeRevisionIndex};this.viewComponent.redraw(a)}this._rendered=true;break;case cv.model.NotificationTypes.CHANGE_RANGE_INDEX:this.viewComponent.enableStageUpdate=true;this.viewComponent.setActive(c.getBody());break;case cv.model.NotificationTypes.CHANGE_INDEX:this.viewComponent.enableStageUpdate=true;var b=c.getBody();this.viewComponent.setActive(b);this.viewComponent.tick();this.facade.sendNotification(cv.model.NotificationTypes.INDEX_CHANGED);break;case cv.model.NotificationTypes.RESIZE:this.viewComponent.redraw(c.getBody());break;case cv.model.NotificationTypes.PAGE_CHANGED:switch(c.getBody()){case"latest":cv.utils.Logger.log("RangeScrollerMed : latest state");this.viewComponent.disablePageNext();this.viewComponent.disableRevNext();break;case"first":cv.utils.Logger.log("RangeScrollerMed : first state");this.viewComponent.disablePagePrevious();this.viewComponent.disableRevPrev();break;case"mid":cv.utils.Logger.log("RangeScrollerMed : mid state");this.viewComponent.activatePaging();this.viewComponent.enableRevNext();this.viewComponent.enableRevPrev();break}break;default:cv.utils.Logger.log("RangeScroller Mediator : unhandled notification")}},_onRevisionsLoaded:function(){this.viewComponent.update(this._repoDataProxy.activeRevisionIndex,this._repoDataProxy.currentPage);this.viewComponent.setActive(this._repoDataProxy.activeRevisionIndex);this.viewComponent.tick()},_onActiveRevChanged:function(){},_onSelectNext:function(){this.facade.sendNotification(cv.model.NotificationTypes.NEXT_REVISION)},_onSelectPrevious:function(){this.facade.sendNotification(cv.model.NotificationTypes.PREVIOUS_REVISION)},_onSelectNextPage:function(){cv.utils.Logger.log("selecting next page");this.facade.sendNotification(cv.model.NotificationTypes.NEXT_PAGE)},_onSelectPreviousPage:function(){this.facade.sendNotification(cv.model.NotificationTypes.PREVIOUS_PAGE)},_onSelectByIndex:function(a){this.facade.sendNotification(cv.model.NotificationTypes.SELECT_BY_INDEX,a)}});cv.view.RangeScrollerMediator.NAME="RangeScrollerMediator";cv.view.RevisionGraphMediator=new Class({Extends:Mediator,_repoDataProxy:null,initialize:function(a){this.parent(cv.view.RevisionGraphMediator.NAME,a)},setData:function(a){this._repoDataProxy=a;this._repoDataProxy.addEvent(cv.model.EventTypes.REVISIONS_LOADED,this._onRevisionsLoaded.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.CAROUSEL_SLIDE_COMPLETE,this._onCarouselSlideComplete.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.PREVIOUS_REVISION,this._onSelectPrevious.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.NEXT_REVISION,this._onSelectNext.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.REVISION_RENDER_COMPLETE,this._onRenderComplete.bind(this));this.viewComponent.addEvent(cv.model.EventTypes.REQUEST_STAGE_UPDATE,this._onStageUpdateRequest.bind(this))},listNotificationInterests:function(){return[cv.model.NotificationTypes.SLIDE_LEFT,cv.model.NotificationTypes.SLIDE_RIGHT,cv.model.NotificationTypes.CHANGE_INDEX,cv.model.NotificationTypes.RESIZE]},handleNotification:function(a){switch(a.name){case cv.model.NotificationTypes.SLIDE_LEFT:this.viewComponent.slideLeft();break;case cv.model.NotificationTypes.SLIDE_RIGHT:this.viewComponent.slideRight();break;case cv.model.NotificationTypes.CHANGE_INDEX:this.viewComponent.changeActiveIndex(a.getBody());this.facade.sendNotification(cv.model.NotificationTypes.INDEX_CHANGED);break;case cv.model.NotificationTypes.RESIZE:this.viewComponent.redraw(a.getBody());break;default:cv.utils.Logger.log("RevisionGraphMediator : unhandled notification")}},_onRevisionsLoaded:function(){this.viewComponent.update(this._repoDataProxy.activeRevisionIndex,this._repoDataProxy.currentPage);this._repoDataProxy.addEvent(cv.model.EventTypes.ACTIVE_REV_CHANGE,this._onActiveRevChanged.bind(this))},_onActiveRevChanged:function(){this.viewComponent.changeActiveIndex(this._repoDataProxy.activeRevisionIndex)},_onCarouselSlideComplete:function(){this.facade.sendNotification(cv.model.NotificationTypes.CAROUSEL_SLIDE_COMPLETE)},_onSelectPrevious:function(){this.facade.sendNotification(cv.model.NotificationTypes.PREVIOUS_REVISION)},_onSelectNext:function(){this.facade.sendNotification(cv.model.NotificationTypes.NEXT_REVISION)},_onRenderComplete:function(){this.facade.sendNotification(cv.model.NotificationTypes.GLYPH_RENDERING_COMPLETE)},_onStageUpdateRequest:function(){this.facade.sendNotification(cv.model.NotificationTypes.REQUEST_STAGE_UPDATE)}});cv.view.RevisionGraphMediator.NAME="RevisionGraphMediator";cv.view.RevisionInfoMediator=new Class({Extends:Mediator,_repoDataProxy:null,initialize:function(a){this.parent(cv.view.RevisionInfoMediator.NAME,a)},setData:function(a){this._repoDataProxy=a;this._repoDataProxy.addEvent(cv.model.EventTypes.REPO_TITLE_CHANGE,this.onRepoTitleChanged.bind(this));this._repoDataProxy.addEvent(cv.model.EventTypes.ACTIVE_REV_CHANGE,this.onActiveRevChanged.bind(this))},onActiveRevChanged:function(a){this.viewComponent.update(a)},onRepoTitleChanged:function(a){this.getViewComponent().setRepoPathTitle(a)}});cv.view.RevisionInfoMediator.NAME="RevisionInfoMediator";cv.ApplicationFacade=new Class({Extends:Facade,initializeController:function(){this.parent();this.registerCommand(cv.model.CommandTypes.INITIALIZE_APP,cv.commands.InitAppCommand)},startup:function(a){this.sendNotification(cv.model.CommandTypes.INITIALIZE_APP,a)}});cv.ApplicationFacade.getInstance=function(){if(Facade.instance==undefined){Facade.instance=new cv.ApplicationFacade()}return Facade.instance};cv.commands.RequestRevDataCommand=new Class({Extends:SimpleCommand,execute:function(f){var c=this.facade.retrieveProxy(cv.model.ConfigProxy.NAME);var a=this.facade.retrieveProxy(cv.model.RepoDataProxy.NAME);a.activeRevisionIndex=-1;var b=f.getBody();if(f.getBody().requestor){c.requestor=f.getBody().requestor;a.cvsType=c.requestor.type;c.requestor.setMethod("GET")}if(f.getBody().pageNum!=undefined){c.requestor.setPageNum(f.getBody().pageNum);c.requestor.generateUrl()}c.requestor.successHandler=this.successHandler;c.requestor.failureHandler=this.failureHandler;try{c.requestor.send()}catch(d){cv.utils.Logger.log(d.message)}},successHandler:function(b){var c=mainView.facade.retrieveProxy(cv.model.RepoDataProxy.NAME);c.repoLocation=b.repoLocation;c.setRepoRootPath(b.repoRootPath);var d=b.isLatest;var a=b.isFirst;c.addPage(cv.model.DataParser.parseRevisions(b),d,a)},failureHandler:function(a){cv.utils.Logger.log("JSON Request failed = "+a)}});cv.commands.AppReadyCommand=new Class({Extends:SimpleCommand,execute:function(c){var a=this.facade.retrieveMediator(cv.view.ApplicationMediator.NAME);var b=a.viewComponent;b.visible(true)}});cv.commands.InitAppCommand=new Class({Extends:MacroCommand,initializeMacroCommand:function(){this.addSubCommand(cv.commands.RegisterCommand);this.addSubCommand(cv.commands.InitModelCommand);this.addSubCommand(cv.commands.InitAppControlCommand);this.addSubCommand(cv.commands.InitViewCommand)}});cv.commands.InitAppControlCommand=new Class({Extends:SimpleCommand,execute:function(d){var c=d.getBody();var b=new cv.view.ApplicationMediator(c);var a=new Keyboard({defaultEventType:"keyup"});b.setKeyboard(a);this.facade.registerMediator(b)}});cv.commands.InitModelCommand=new Class({Extends:SimpleCommand,execute:function(a){this.facade.registerProxy(new cv.model.RepoDataProxy());this.facade.registerProxy(new cv.model.ConfigProxy())}});cv.commands.InitViewCommand=new Class({Extends:SimpleCommand,execute:function(f){var n=this.facade.retrieveProxy(cv.model.RepoDataProxy.NAME);var a=this.facade.retrieveProxy(cv.model.ConfigProxy.NAME);var l=this.facade.retrieveMediator(cv.view.ApplicationMediator.NAME);var j=l.viewComponent;a.lineColor=j.lineColor;n.currentPageSize=l.listControlLength;n.viewportWidth=a.viewportWidth;if(j.getStage()){var b=new cv.view.Bullseye(j.getStage(),1000,a.lineColor);var d=new cv.view.RevisionInfoPanel();var g=new cv.view.RevisionInfoMediator(d);g.setData(n);var c=new cv.view.RevisionGraph(j.getStage(),a.viewportWidth);var k=new cv.view.RevisionGraphMediator(c);k.setData(n);this.facade.registerMediator(k);var m=new cv.view.RangeScroller(l.getRangeScrollerWidth(),a.lineColor);var i=new cv.view.RangeScrollerMediator(m);i.setData(n);this.facade.registerMediator(i);var e=new cv.view.EntryInfoPanel(a.lineColor);var h=new cv.view.EntryInfoMediator(e);this.facade.registerMediator(h)}else{$("root").appendText("Sorry - this application requires HTML5 support.")}}});cv.commands.RegisterCommand=new Class({Extends:SimpleCommand,execute:function(a){this.facade.registerCommand(cv.model.CommandTypes.REQUEST_REV_DATA,cv.commands.RequestRevDataCommand);this.facade.registerCommand(cv.model.CommandTypes.APP_READY,cv.commands.AppReadyCommand);this.facade.registerCommand(cv.model.CommandTypes.AUTO_LOAD_CODE_STYLE,cv.commands.InitCodeViewCommand)}});